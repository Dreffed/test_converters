.viewer-layout { display: grid; grid-template-columns: 1fr; gap: 16px; }
.viewer-side { border: 1px solid #ddd; padding: 12px; border-radius: 6px; }
.viewer-main { display: flex; flex-direction: column; min-height: 60vh; }
.group { margin-bottom: 12px; }
.row { display: flex; align-items: center; gap: 8px; margin: 4px 0; }
.legend { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.legend .item { display: flex; align-items: center; gap: 6px; font-size: 12px; }
.legend .swatch { width: 14px; height: 14px; border: 1px solid #999; }
.toolbar { display: flex; align-items: center; gap: 8px; border: 1px solid #ddd; padding: 6px 8px; border-radius: 6px; }
.toolbar .spacer { flex: 1; }
.viewport { position: relative; overflow: auto; border: 1px solid #ddd; margin-top: 8px; border-radius: 6px; height: 60vh; }
.canvas { position: relative; transform-origin: 0 0; display: inline-block; }
#pageImg { display: block; max-width: 100%; height: auto; }
#overlay { position: absolute; left: 0; top: 0; pointer-events: auto; }
.select-rect { fill: rgba(0, 128, 255, 0.1); stroke: #0080ff; stroke-width: 1; }
.bbox { fill: none; stroke-width: 2; }
.bbox-label { font-size: 11px; fill: #000; stroke: #fff; stroke-width: 0.5; paint-order: stroke; }
.bbox-badge-circle { stroke: #ffffff; stroke-width: 1.2; }
.bbox-badge-text { font-size: 10.5px; font-weight: 600; text-anchor: middle; dominant-baseline: middle; paint-order: stroke; stroke: rgba(0,0,0,0.35); stroke-width: 0.8; }
.bbox-selected { fill: rgba(0,128,255,0.12); stroke: #0080ff; stroke-width: 3; pointer-events: none; }
.bbox-redundant { stroke-dasharray: 4 3; stroke: #888; }
.bbox-unique { stroke: #ff00aa; stroke-width: 2.5; }
.cons-group { stroke: #8a2be2; stroke-width: 2; fill: none; }
.bottom-panel { border-top: 1px solid #ddd; margin-top: 8px; padding-top: 8px; }
.bottom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
.bottom-grid .text-col, .bottom-grid .tables-col { min-width: 0; }
.tabs { display: flex; gap: 8px; margin-bottom: 6px; }
.tabs button[aria-selected="true"] { font-weight: 600; }
.panel { display: none; }
.panel[aria-hidden="false"] { display: block; }
.warn { color: #a86400; font-size: 12px; }

/* Horizontal menu */
.viewer-menu { display: flex; flex-wrap: wrap; gap: 10px; align-items: stretch; border: 1px solid #ddd; border-radius: 6px; padding: 6px; background: #fafafa; }
.viewer-menu .menu { position: relative; }
.viewer-menu .menu-title { border: 1px solid #ccc; background: #fff; padding: 6px 10px; border-radius: 4px; cursor: pointer; }
.viewer-menu .menu-content { display: none; position: absolute; z-index: 20; min-width: 260px; background: #fff; border: 1px solid #ccc; box-shadow: 0 4px 16px rgba(0,0,0,0.08); border-radius: 6px; padding: 10px; top: calc(100% + 6px); left: 0; }
.viewer-menu .menu:hover .menu-content { display: block; }
.viewer-menu .menu .group { margin-bottom: 8px; }

/* Status viewer */
.status-viewer { margin-top: 8px; border: 1px solid #ddd; border-radius: 6px; padding: 6px 8px; background: #fff; font-size: 13px; }
.status-viewer ul { list-style: none; margin: 0; padding: 0; display: flex; gap: 10px; flex-wrap: wrap; }
.status-viewer li { display: inline-flex; align-items: center; gap: 6px; padding: 2px 6px; border: 1px solid #eee; border-radius: 4px; }
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: #aaa; display: inline-block; }
.status-busy { background: #e6a700; }
.status-ok { background: #2e8b57; }
.status-fail { background: #b00020; }

/* Responsive */
@media (max-width: 1024px) {
  .viewer-layout { grid-template-columns: 1fr; }
  .viewer-side { order: 1; }
  .viewer-main { order: 2; }
  .viewport { height: 50vh; }
  .legend { grid-template-columns: repeat(3, 1fr); }
  .bottom-grid { grid-template-columns: 1fr; }
}

@media (max-width: 640px) {
  .toolbar { flex-wrap: wrap; gap: 6px; }
  .viewport { height: 45vh; }
  .legend { grid-template-columns: repeat(2, 1fr); }
  .group label, .group input, .group select { max-width: 100%; }
  .bottom-grid { grid-template-columns: 1fr; }
}
