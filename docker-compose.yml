services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      APP_DATA_DIR: /data
      POPPLER_PATH: /usr/bin
    volumes:
      - ./data:/data
      # Optionally mount a custom Poppler build and set POPPLER_PATH accordingly
      # - ./poppler:/opt/poppler
      # environment:
      #   - POPPLER_PATH=/opt/poppler

  app-dev:
    build: .
    ports:
      - "8080:8080"
    environment:
      APP_DATA_DIR: /data
      POPPLER_PATH: /usr/bin
    volumes:
      - ./:/app
      - ./data:/data
    command: >-
      uvicorn ui_server:app --host 0.0.0.0 --port 8080
      --reload --reload-dir /app
      --reload-include "*.py"
      --reload-include "templates/*.html"
      --reload-include "static/*.js"
      --reload-include "static/*.css"
    profiles:
      - dev
