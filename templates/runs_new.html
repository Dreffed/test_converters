{% extends 'base.html' %}
{% block content %}
<h2>New Run</h2>
<form method="post" action="/runs">
  <h3>Select Uploaded Files</h3>
  {% if uploads and uploads|length > 0 %}
    <ul>
    {% for f in uploads %}
      <li data-file-name="{{ f.name }}">
        <label>
          <input type="checkbox" name="files" value="{{ f.name }}" />
          {{ f.name }} ({{ f.size }} bytes)
        </label>
        <button type="button" class="btn btn-danger delete-upload" data-file-name="{{ f.name }}">Delete</button>
      </li>
    {% endfor %}
    </ul>
  {% else %}
    <p>No uploaded PDFs found. Go back to Home to upload.</p>
  {% endif %}

  <label>Additional files (comma-separated full paths inside container):
    <input name="extra_files" placeholder="/data/uploads/extra.pdf"/>
  </label>
  <br/>

  <label>Converters (comma-separated):
    <input name="converters" value="{{ ','.join(available or []) }}"/>
  </label>
  <br/>
  <label>Baseline:
    <input name="baseline" value="{{ config.baseline }}"/>
  </label>
  <br/>

  <button class="btn" type="submit">Start</button>
  <a class="btn" href="/">Cancel</a>
  <p>Available converters: {{ ', '.join(available or []) }}</p>
</form>
<script>
  document.querySelectorAll('.delete-upload').forEach(btn => {
    btn.addEventListener('click', async () => {
      const name = btn.getAttribute('data-file-name');
      if (!name) return;
      if (!confirm(`Delete uploaded file ${name}?`)) return;
      try{
        const resp = await fetch(`/api/files/${encodeURIComponent(name)}`, { method: 'DELETE' });
        if (resp.ok) { location.reload(); } else { alert('Failed to delete file'); }
      } catch { alert('Error deleting file'); }
    });
  });
</script>
{% endblock %}
